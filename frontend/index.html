<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DQS Engine - Data Quality Scoring Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">DQS</div>
                    <div class="logo-text">
                        <h1>Data Quality Scoring Engine</h1>
                        <p>15-Layer Payment Gateway Quality Assessment</p>
                    </div>
                </div>
                <div class="header-status">
                    <span class="status-dot"></span>
                    <span id="apiStatus">Connecting...</span>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Data Input Section -->
            <section class="data-input-section glass-card">
                <h2>Data Input</h2>
                <div class="input-tabs">
                    <button class="tab-btn active" data-tab="generate" onclick="switchTab('generate')">Generate
                        Sample</button>
                    <button class="tab-btn" data-tab="json" onclick="switchTab('json')">JSON Input</button>
                    <button class="tab-btn" data-tab="csv" onclick="switchTab('csv')">CSV Upload</button>
                </div>

                <!-- Generate Tab -->
                <div class="tab-content active" id="tab-generate">
                    <div class="control-grid">
                        <div class="control-group">
                            <label for="txnCount">Transaction Count</label>
                            <input type="range" id="txnCount" min="10" max="200" value="50"
                                oninput="updateSlider('txnCount', 'txnCountValue')">
                            <span id="txnCountValue" class="slider-value">50</span>
                        </div>
                        <div class="control-group">
                            <label for="anomalyRate">Anomaly Rate</label>
                            <input type="range" id="anomalyRate" min="0" max="50" value="15"
                                oninput="updateSlider('anomalyRate', 'anomalyRateValue')">
                            <span id="anomalyRateValue" class="slider-value">15%</span>
                        </div>
                        <div class="control-group">
                            <label for="useAI">Enable Gemini AI</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="useAI">
                                <label for="useAI"></label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- JSON Tab -->
                <div class="tab-content" id="tab-json">
                    <div class="json-input-container">
                        <label>Paste your JSON transaction data:</label>
                        <textarea id="jsonInput" class="json-textarea" placeholder='[
  {
    "transaction": {
      "transaction_id": "txn_001",
      "amount": 5000,
      "currency": "INR",
      ...
    },
    "card": { ... },
    "merchant": { ... },
    ...
  }
]'></textarea>
                        <div class="json-actions">
                            <button class="btn btn-secondary" onclick="validateJson()">Validate JSON</button>
                            <button class="btn btn-secondary" onclick="loadSampleJson()">Load Sample</button>
                            <span id="jsonStatus" class="json-status"></span>
                        </div>
                    </div>
                </div>

                <!-- CSV Tab -->
                <div class="tab-content" id="tab-csv">
                    <div class="csv-upload-container">
                        <div class="file-drop-zone" id="dropZone">
                            <div class="drop-icon">üìÅ</div>
                            <p>Drag and drop your CSV file here</p>
                            <p class="drop-hint">or</p>
                            <input type="file" id="csvFile" accept=".csv" onchange="handleFileUpload(event)" hidden>
                            <button class="btn btn-secondary"
                                onclick="document.getElementById('csvFile').click()">Browse Files</button>
                        </div>
                        <div id="fileInfo" class="file-info" style="display: none;">
                            <span class="file-name" id="fileName"></span>
                            <span class="file-size" id="fileSize"></span>
                            <button class="btn-icon-small" onclick="clearFile()">‚úï</button>
                        </div>
                    </div>
                </div>

                <!-- Run Button -->
                <div class="run-section">
                    <button id="runPipelineBtn" class="btn btn-primary btn-large" onclick="runPipeline()">
                        <span class="btn-icon">‚ñ∂</span>
                        Run Quality Analysis
                    </button>
                </div>
            </section>

            <!-- Data Preview Section -->
            <section class="data-preview glass-card" id="dataPreviewSection" style="display: none;">
                <div class="section-header">
                    <h2>Data Preview</h2>
                    <span class="record-count" id="previewCount">0 records</span>
                </div>
                <div class="preview-table-container">
                    <table class="preview-table" id="previewTable">
                        <thead id="previewTableHead"></thead>
                        <tbody id="previewTableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- Phase Pipeline Visualization -->
            <section class="phase-pipeline glass-card">
                <h2>Pipeline Phases</h2>
                <div class="pipeline-flow">
                    <div class="phase phase-1" data-phase="1">
                        <div class="phase-header">
                            <span class="phase-number">1</span>
                            <span class="phase-name">Foundation</span>
                        </div>
                        <div class="phase-layers">
                            <div class="layer" data-layer="1">L1: Input Contract</div>
                            <div class="layer" data-layer="2">L2: Input Validation</div>
                        </div>
                    </div>
                    <div class="pipeline-arrow">‚Üí</div>
                    <div class="phase phase-2" data-phase="2">
                        <div class="phase-header">
                            <span class="phase-number">2</span>
                            <span class="phase-name">Features</span>
                        </div>
                        <div class="phase-layers">
                            <div class="layer" data-layer="3">L3: Feature Extraction</div>
                        </div>
                    </div>
                    <div class="pipeline-arrow">‚Üí</div>
                    <div class="phase phase-3" data-phase="3">
                        <div class="phase-header">
                            <span class="phase-number">3</span>
                            <span class="phase-name">Deterministic</span>
                        </div>
                        <div class="phase-layers">
                            <div class="layer" data-layer="4.1">L4.1: Structural</div>
                            <div class="layer" data-layer="4.2">L4.2: Compliance</div>
                            <div class="layer" data-layer="4.3">L4.3: Semantic</div>
                        </div>
                    </div>
                    <div class="pipeline-arrow">‚Üí</div>
                    <div class="phase phase-4" data-phase="4">
                        <div class="phase-header">
                            <span class="phase-number">4</span>
                            <span class="phase-name">AI Inference</span>
                        </div>
                        <div class="phase-layers">
                            <div class="layer ai-layer" data-layer="4.4">L4.4: Anomaly ML</div>
                            <div class="layer ai-layer" data-layer="4.5">L4.5: GenAI</div>
                        </div>
                    </div>
                    <div class="pipeline-arrow">‚Üí</div>
                    <div class="phase phase-5" data-phase="5">
                        <div class="phase-header">
                            <span class="phase-number">5</span>
                            <span class="phase-name">Output</span>
                        </div>
                        <div class="phase-layers">
                            <div class="layer" data-layer="5">L5: Contract</div>
                            <div class="layer" data-layer="6">L6: Stability</div>
                            <div class="layer" data-layer="7">L7: Conflicts</div>
                            <div class="layer" data-layer="8">L8: Confidence</div>
                        </div>
                    </div>
                    <div class="pipeline-arrow">‚Üí</div>
                    <div class="phase phase-6" data-phase="6">
                        <div class="phase-header">
                            <span class="phase-number">6</span>
                            <span class="phase-name">Decision</span>
                        </div>
                        <div class="phase-layers">
                            <div class="layer" data-layer="9">L9: Decision Gate</div>
                            <div class="layer" data-layer="10">L10: Responsibility</div>
                        </div>
                    </div>
                    <div class="pipeline-arrow">‚Üí</div>
                    <div class="phase phase-7" data-phase="7">
                        <div class="phase-header">
                            <span class="phase-number">7</span>
                            <span class="phase-name">Logging</span>
                        </div>
                        <div class="phase-layers">
                            <div class="layer" data-layer="11">L11: Trace</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Results Dashboard -->
            <section class="results-dashboard" id="resultsSection" style="display: none;">
                <!-- Summary Cards -->
                <div class="summary-cards">
                    <div class="summary-card card-success">
                        <div class="card-icon">‚úì</div>
                        <div class="card-content">
                            <span class="card-value" id="safeCount">0</span>
                            <span class="card-label">Safe to Use</span>
                        </div>
                        <div class="card-description">Ready for processing</div>
                    </div>
                    <div class="summary-card card-warning">
                        <div class="card-icon">‚ö†</div>
                        <div class="card-content">
                            <span class="card-value" id="reviewCount">0</span>
                            <span class="card-label">Review Required</span>
                        </div>
                        <div class="card-description">Needs human verification</div>
                    </div>
                    <div class="summary-card card-danger">
                        <div class="card-icon">!</div>
                        <div class="card-content">
                            <span class="card-value" id="escalateCount">0</span>
                            <span class="card-label">Escalate</span>
                        </div>
                        <div class="card-description">Urgent attention needed</div>
                    </div>
                    <div class="summary-card card-neutral">
                        <div class="card-icon">√ó</div>
                        <div class="card-content">
                            <span class="card-value" id="rejectedCount">0</span>
                            <span class="card-label">Rejected</span>
                        </div>
                        <div class="card-description">Failed validation</div>
                    </div>
                </div>

                <!-- Metrics Row -->
                <div class="metrics-row">
                    <div class="metric-card glass-card">
                        <div class="metric-circle" id="qualityCircle">
                            <svg viewBox="0 0 100 100">
                                <circle class="metric-bg" cx="50" cy="50" r="45"></circle>
                                <circle class="metric-fill" cx="50" cy="50" r="45" id="qualityFill"></circle>
                            </svg>
                            <div class="metric-value" id="qualityRate">0%</div>
                        </div>
                        <span class="metric-label">Quality Rate</span>
                        <span class="metric-hint">Percentage of safe records</span>
                    </div>
                    <div class="metric-card glass-card">
                        <div class="metric-circle" id="dqsCircle">
                            <svg viewBox="0 0 100 100">
                                <circle class="metric-bg" cx="50" cy="50" r="45"></circle>
                                <circle class="metric-fill dqs-fill" cx="50" cy="50" r="45" id="dqsFill"></circle>
                            </svg>
                            <div class="metric-value" id="avgDqs">0</div>
                        </div>
                        <span class="metric-label">Average DQS</span>
                        <span class="metric-hint">Data Quality Score (0-100)</span>
                    </div>
                    <div class="metric-card glass-card">
                        <div class="metric-info">
                            <span class="metric-big" id="totalRecords">0</span>
                            <span class="metric-sub">records</span>
                        </div>
                        <span class="metric-label">Total Processed</span>
                        <span class="metric-hint">Input transactions analyzed</span>
                    </div>
                    <div class="metric-card glass-card">
                        <div class="metric-info">
                            <span class="metric-big" id="duration">0</span>
                            <span class="metric-sub">ms</span>
                        </div>
                        <span class="metric-label">Total Duration</span>
                        <span class="metric-hint">Pipeline execution time</span>
                    </div>
                </div>

                <!-- Layer Details -->
                <div class="layer-details glass-card">
                    <div class="section-header">
                        <h2>Layer Execution Details</h2>
                        <span class="layer-count">15 layers executed</span>
                    </div>
                    <div class="layer-table-container">
                        <table class="layer-table">
                            <thead>
                                <tr>
                                    <th>Layer</th>
                                    <th>Name</th>
                                    <th>Status</th>
                                    <th>Duration</th>
                                    <th>Checks</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="layerTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- AI Analysis Section -->
                <div class="ai-analysis glass-card" id="aiAnalysisSection">
                    <div class="section-header">
                        <h2>Quality Analysis Summary</h2>
                        <span class="ai-badge">AI-Powered Insights</span>
                    </div>
                    <div class="analysis-content" id="analysisContent">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>

                <!-- Records Requiring Review -->
                <div class="review-records glass-card" id="reviewRecordsSection" style="display: none;">
                    <div class="section-header">
                        <h2>Records Requiring Attention</h2>
                        <span class="review-count-badge" id="reviewBadge">0</span>
                    </div>
                    <div class="review-cards" id="reviewCards">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>

                <!-- Reports Section -->
                <div class="reports-section">
                    <div class="report-card glass-card">
                        <div class="section-header">
                            <h3>Decision Report</h3>
                            <button class="btn-copy" onclick="copyReport('decisionReport')">Copy</button>
                        </div>
                        <div class="report-content-wrapper">
                            <div id="decisionReport" class="report-content"></div>
                        </div>
                    </div>
                    <div class="report-card glass-card">
                        <div class="section-header">
                            <h3>Execution Log</h3>
                            <button class="btn-copy" onclick="copyReport('executionReport')">Copy</button>
                        </div>
                        <div class="report-content-wrapper">
                            <div id="executionReport" class="report-content"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Processing <span id="loadingLayer">Layer 1</span></div>
                    <div class="loading-phase" id="loadingPhase">Phase 1: Foundation</div>
                    <div class="loading-progress">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="loading-percent" id="loadingPercent">0%</div>
                </div>
            </div>

            <!-- Error Modal -->
            <div class="error-modal" id="errorModal" style="display: none;">
                <div class="error-modal-content glass-card">
                    <div class="error-header">
                        <span class="error-icon">‚ö†</span>
                        <h3>Error Occurred</h3>
                    </div>
                    <div class="error-body">
                        <p id="errorMessage"></p>
                        <div class="error-details" id="errorDetails" style="display: none;">
                            <h4>Technical Details</h4>
                            <pre id="errorTrace"></pre>
                        </div>
                    </div>
                    <div class="error-actions">
                        <button class="btn btn-secondary" onclick="toggleErrorDetails()">Show Details</button>
                        <button class="btn btn-primary" onclick="closeErrorModal()">Close</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>DQS Engine v1.0 ‚Ä¢ 15 Layers ‚Ä¢ 7 Phases ‚Ä¢ "Rules Enforce, ML Informs, Humans Decide"</p>
        </footer>
    </div>

    <script src="script.js"></script>
</body>

</html>